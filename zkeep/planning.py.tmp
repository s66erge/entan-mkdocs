# In your planning.py
def planning_page_with_timer(session, db):
    return Html(
        Head(Title('Planning with Timer')),
        Body(
            # Timer at top
            Div('60:00', id='session-timer', 
                style='font-size: 36px; text-align: center; margin: 10px;'),
            
            # Your existing planning content
            planning_content(session, db),
            
            # Timer script
            Script('''
                let totalSeconds = 60 * 60;
                
                function startTimer() {
                    const timerEl = document.getElementById('session-timer');
                    
                    setInterval(() => {
                        totalSeconds--;
                        
                        if (totalSeconds <= 0) {
                            timerExpired();
                            return;
                        }
                        
                        const minutes = Math.floor(totalSeconds / 60);
                        timerEl.textContent = `${minutes} minutes remaining`;
                        
                        // Color warnings
                        if (totalSeconds <= 300) timerEl.style.color = 'orange';
                        if (totalSeconds <= 60) timerEl.style.color = 'red';
                        
                    }, 1000);
                }
                
                function timerExpired() {
                    // Call your custom function
                    fetch('/planning_session_expired', { method: 'POST' });
                    window.location.href = '/timeout';
                }
                
                document.addEventListener('DOMContentLoaded', startTimer);
            ''')
        )
    )

@rt('/planning_session_expired', methods=['POST'])
def planning_session_expired():
    """Called when planning session expires."""
    # Save draft work, send notifications, etc.
    return {'status': 'planning_session_expired'}